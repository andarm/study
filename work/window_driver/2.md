# windbug 
## [目录](README.md)

### 设置环境 

SRV*c:\pro\mysymbol* http://msdl.microsoft.com/download/symbols  
（1）需要在windbg中设置
 c:\pro\mysymbol;SRV*c:\pro\mysymbol* http://msdl.microsoft.com/download/symbols 
 (2) 也需要在window环境变量中设置添加 _NT_SYMBOL_PATH 

### 指定驱动所需的程序调试数据库路径（编译驱动输出的.pdb文件路径）

kd> .sympath C:\Users\lin\source\repos\KMDF Driver3\x64\Debug

### 重载  /n只加载内核模块（根据需求选择）

kd> .reload /n /f

### 在代码处设置断点，运行调试

kd> g 

### 调试需要重启远程调试机子  

- kd> .reboot 
- kd> .crash    

### 在不需要远程，或者调试完先关闭

- kd>  qd   调试进程继续  ，q 调试进程也会关闭  



### 调试使用命令

- 目录  

 cd C:\Program Files (x86)\Windows Kits\10\Debuggers\x64
 如果有其它符路径用分号隔开，如  ;c:\pdb //设置调试文件路径 
 C:\Users\lin\source\repos\KMDF Driver3\x64\Debug

串口
windbg -b -k com:pipe,port=\\.\pipe\com_1,resets=0
网络
WinDbg –k net:port=50000,key=1.2.3.4

SRV*c:\pro\mysymbol* http://msdl.microsoft.com/download/symbols

SRV*c:\pro\mysymbol* http://msdl.microsoft.com/download/symbols;C:\Users\lin\source\repos\KMDF Driver3\x64\Debug


### vs2017 中设置sympath

- kd> .sympath SRV*c:\pro\mysymbol*http://msdl.microsoft.com/download/symbols;C:\Users\lin\source\repos\KMDF Driver3\x64\Debug

.sympath SRV*c:\pro\mysymbol*http://msdl.microsoft.com/download/symbols

远程机子 ： 


### windbg  调试存在PDB文件  
bp "KMDF Driver3"!DriverEntry

### windbg 调试不存在pdb文件

sxe ld "KMDF Driver3.sys"

### vs2017 添加先的调试文件路径 

.sympath+ C:\Users\lin\source\repos\KMDF Driver2\KMDF Driver2\x64\Debug 
.sympath+ C:\pro\WindowDriver\src\Windows-driver-samples\general\echo\kmdf\driver\AutoSync\x64\Debug
添加后需要加载 
.reload  


### 添加源代码路径 

.srcpath+ C:\pro\WindowDriver\src\Windows-driver-samples\general\echo\kmdf\driver\AutoSync 

- 添加后可以实现在线调试，同时将.sympath ,.srcpath 都添加上 。 

需要一个默认配置环境  

_NT_SYMBOL_PATH   =  SRV*c:\pro\mysymbol* http://msdl.microsoft.com/download/symbols

### 显示 

.DbgPrint 

### windbg 调试命令 

- bl  列出所有断点  
- bp 创建断点  
- bc 清除所有断点   bc 1 清除第一个 断点 


.sympath c:\mypdbs;srv*c:\msftpdbs*http://msdl.microsoft.com/download/symbols 


###  windbg 配置调试 

 Module load completed but symbols could not be loaded for bootmgr



### windbg 问题 

WARNING: Unable to verify checksum for 


### 使用串口 管道方式  

windbg -y SRV*c:\pro\mysymbol*http://msdl.microsoft.com/download/symbols -b -k com:port=\\.\pipe\com_1,baud=115200

### 使用网络方式  

windbg -y d:\mysymbols -k net:port=50000,key=AutoGeneratedKey
windbg -y d:\mysymbols -k net:port=50000,key=AutoGeneratedKey,target=TargetIPAddress 
